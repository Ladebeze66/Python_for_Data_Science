# Exercice 03 : Draw my year - Documentation compl√®te

## üìã **Objectif de l'exercice**

Cr√©er un graphique de corr√©lation (scatter plot) montrant la relation entre le PIB par habitant et l'esp√©rance de vie pour l'ann√©e 1900, en fusionnant deux datasets diff√©rents.

## üéØ **Comp√©tences d√©velopp√©es**

- **Fusion de datasets** : Combiner deux fichiers CSV sur une cl√© commune (pays)
- **Analyse de corr√©lation** : Visualiser la relation entre deux variables quantitatives
- **Scatter plot** : Cr√©er un graphique en nuage de points avec matplotlib
- **√âchelle logarithmique** : Utiliser une √©chelle log pour g√©rer des donn√©es avec de grandes variations
- **Nettoyage de donn√©es** : G√©rer les valeurs manquantes et les conversions de types
- **Configuration avanc√©e d'axes** : Personnaliser les marques et limites des axes

## üìÅ **Structure des fichiers**

```
ex03/
‚îú‚îÄ‚îÄ load_csv.py                                          # Fonction load() de l'ex00
‚îú‚îÄ‚îÄ projection_life.py                                   # Programme principal (cr√©√©)
‚îú‚îÄ‚îÄ life_expectancy_years.csv                           # Dataset esp√©rance de vie
‚îú‚îÄ‚îÄ income_per_person_gdppercapita_ppp_inflation_adjusted.csv  # Dataset PIB
‚îî‚îÄ‚îÄ ex03.md                                             # Cette documentation
```

## üìä **Analyse des datasets**

### **Dataset 1 : PIB par habitant**
- **Fichier** : `income_per_person_gdppercapita_ppp_inflation_adjusted.csv`
- **Contenu** : PIB par habitant ajust√© √† l'inflation (PPP)
- **Format** : Valeurs num√©riques (683, 1000, 2500, etc.)
- **Unit√©** : Dollars internationaux

### **Dataset 2 : Esp√©rance de vie**
- **Fichier** : `life_expectancy_years.csv`
- **Contenu** : Esp√©rance de vie √† la naissance
- **Format** : Valeurs num√©riques (25.5, 35.2, 45.8, etc.)
- **Unit√©** : Ann√©es

### **Ann√©e cible : 1900**
- **Contexte historique** : D√©but de l'industrialisation, grandes disparit√©s mondiales
- **Int√©r√™t** : Observer les in√©galit√©s √©conomiques et sanitaires de l'√©poque

## üîß **D√©fis techniques principaux**

### **1. Fusion de datasets**
**Probl√®me** : Deux fichiers s√©par√©s avec des pays potentiellement diff√©rents
**Solution** : `pd.merge()` sur la colonne 'country'

### **2. Gestion des donn√©es manquantes**
**Probl√®me** : Certains pays n'ont pas de donn√©es pour 1900
**Solution** : Filtrage avec `.dropna()` et masques bool√©ens

### **3. √âchelle logarithmique**
**Probl√®me** : PIB varie de 300 √† 10000+ (facteur 30+)
**Solution** : `plt.xscale('log')` pour une meilleure visualisation

### **4. Configuration pr√©cise des axes**
**Probl√®me** : Correspondre exactement au visuel de r√©f√©rence
**Solution** : Configuration manuelle avec `plt.xticks()` et `plt.yticks()`

## üíª **Impl√©mentation d√©taill√©e**

### **Architecture du programme**

```python
def main():
    """Fonction principale - 9 √©tapes cl√©s"""
    # 1. Chargement des datasets
    # 2. Extraction ann√©e 1900
    # 3. Fusion des donn√©es
    # 4. Nettoyage
    # 5. Conversion num√©rique
    # 6. Cr√©ation du scatter plot
    # 7. Configuration des axes
    # 8. Titre et l√©gendes
    # 9. Affichage
```

### **√âtape 1 : Chargement des datasets**

```python
gdp_dataset = load(
    "income_per_person_gdppercapita_ppp_inflation_adjusted.csv")
life_dataset = load("life_expectancy_years.csv")
```

**Points techniques :**
- R√©utilisation de la fonction `load()` de l'ex00
- Gestion d'erreur si l'un des fichiers ne se charge pas
- Noms de variables explicites pour la lisibilit√©

### **√âtape 2 : Extraction de l'ann√©e 1900**

```python
gdp_1900 = gdp_dataset[['country', '1900']].copy()
life_1900 = life_dataset[['country', '1900']].copy()
```

**Points techniques :**
- S√©lection de colonnes sp√©cifiques avec `[['country', '1900']]`
- `.copy()` pour √©viter les warnings de modification
- Pr√©paration pour la fusion

### **√âtape 3 : Fusion des datasets**

```python
merged_data = pd.merge(gdp_1900, life_1900, on='country',
                       suffixes=('_gdp', '_life'))
```

**Points techniques :**
- `pd.merge()` : Jointure SQL-like sur la colonne 'country'
- `suffixes=('_gdp', '_life')` : √âvite les conflits de noms de colonnes
- R√©sultat : DataFrame avec colonnes 'country', '1900_gdp', '1900_life'

### **√âtape 4 : Nettoyage des donn√©es**

```python
merged_data = merged_data.dropna()
```

**Points techniques :**
- Supprime les lignes avec des valeurs manquantes
- Essentiel pour √©viter les erreurs lors de la conversion num√©rique
- Alternative √† un filtrage manuel plus complexe

### **√âtape 5 : Conversion num√©rique et filtrage**

```python
gdp_values = pd.to_numeric(merged_data['1900_gdp'], errors='coerce')
life_values = pd.to_numeric(merged_data['1900_life'], errors='coerce')

valid_mask = gdp_values.notna() & life_values.notna()
gdp_values = gdp_values[valid_mask]
life_values = life_values[valid_mask]
```

**Points techniques :**
- `pd.to_numeric(..., errors='coerce')` : Convertit en NaN si impossible
- `.notna()` : Version moderne de `~.isna()` (√©vite les warnings de d√©pr√©ciation)
- Masque bool√©en pour garder seulement les paires compl√®tes

### **√âtape 6 : Cr√©ation du scatter plot**

```python
plt.figure(figsize=(8, 6))
plt.scatter(gdp_values, life_values, alpha=0.6, color='blue', s=30)
```

**Points techniques :**
- `figsize=(8, 6)` : Ratio optimal pour la lisibilit√©
- `alpha=0.6` : Transparence pour voir les points qui se chevauchent
- `s=30` : Taille des points adapt√©e au nombre de donn√©es
- `color='blue'` : Couleur uniforme pour tous les pays

### **√âtape 7 : Configuration des axes**

```python
plt.xscale('log')
plt.xlim(300, 10000)
plt.ylim(18, 55)

plt.xticks([300, 1000, 10000], ['300', '1k', '10k'])
plt.yticks([20, 25, 30, 35, 40, 45, 50, 55])
```

**Points techniques :**
- `plt.xscale('log')` : **Crucial** pour visualiser la corr√©lation
- `xlim(300, 10000)` : Couvre la plage des donn√©es PIB
- `ylim(18, 55)` : Commence sous 20 pour laisser de l'espace visuel
- Marques personnalis√©es pour correspondre au visuel de r√©f√©rence

### **√âtape 8 : Titre et l√©gendes**

```python
plt.title("1900", fontsize=14)
plt.xlabel("Gross domestic product", fontsize=12)
plt.ylabel("Life Expectancy", fontsize=12)
```

**Points techniques :**
- Titre simple mais informatif (ann√©e analys√©e)
- Labels des axes en anglais (conformit√© au sujet)
- Tailles de police hi√©rarchis√©es (titre > axes)

### **√âtape 9 : Grille et affichage**

```python
plt.grid(True, alpha=0.3, linestyle='-', linewidth=0.5)
plt.show()
```

**Points techniques :**
- Grille discr√®te (`alpha=0.3`) pour faciliter la lecture
- `linewidth=0.5` : Lignes fines et √©l√©gantes
- `plt.show()` : Affichage final du graphique

## üìà **R√©sultat et interpr√©tation**

### **Graphique produit :**
- **Type** : Scatter plot (nuage de points)
- **Axe X** : PIB par habitant (√©chelle logarithmique, 300 √† 10k)
- **Axe Y** : Esp√©rance de vie (√©chelle lin√©aire, 20 √† 55 ans)
- **Points** : ~150-180 pays (selon disponibilit√© des donn√©es 1900)
- **Couleur** : Bleu uniforme

### **Corr√©lation observ√©e :**

#### **Tendance g√©n√©rale : POSITIVE**
- **Pays pauvres** (PIB < 1000) : Esp√©rance de vie 20-35 ans
- **Pays moyens** (PIB 1000-3000) : Esp√©rance de vie 30-45 ans  
- **Pays riches** (PIB > 3000) : Esp√©rance de vie 40-55 ans

#### **Observations d√©taill√©es :**
1. **Corr√©lation forte** : Plus le PIB augmente, plus l'esp√©rance de vie augmente
2. **Relation non-lin√©aire** : L'effet diminue aux hauts revenus
3. **Dispersion importante** : Facteurs culturels, g√©ographiques, politiques
4. **Quelques outliers** : Pays avec PIB/esp√©rance de vie d√©corr√©l√©s

### **Contexte historique 1900 :**
- **R√©volution industrielle** : D√©but des grandes disparit√©s √©conomiques
- **M√©decine naissante** : Vaccins et hygi√®ne encore limit√©s
- **In√©galit√©s mondiales** : Europe/Am√©rique du Nord vs reste du monde
- **Esp√©rance moyenne mondiale** : ~30-35 ans (vs ~72 ans aujourd'hui)

## ‚úÖ **Conformit√© aux exigences**

### **Exigences de l'exercice 03 :**
- ‚úÖ **R√©pertoire** : `ex03/`
- ‚úÖ **Fichiers** : `load_csv.py`, `projection_life.py`
- ‚úÖ **Fonction load()** : R√©utilis√©e de l'ex00
- ‚úÖ **Datasets** : Les deux fichiers CSV charg√©s
- ‚úÖ **Ann√©e 1900** : Donn√©es filtr√©es sur 1900 uniquement
- ‚úÖ **Corr√©lation PIB/Esp√©rance** : Relation clairement visible
- ‚úÖ **Titre** : "1900"
- ‚úÖ **L√©gendes axes** : "Gross domestic product" et "Life Expectancy"
- ‚úÖ **Librairies** : matplotlib utilis√©e

### **Bonnes pratiques respect√©es :**
- ‚úÖ **Fonction main()** : Structure obligatoire
- ‚úÖ **Docstrings** : Fonction document√©e
- ‚úÖ **Gestion d'erreurs** : Datasets manquants, donn√©es invalides
- ‚úÖ **Norme flake8** : Lignes < 79 caract√®res
- ‚úÖ **Code lisible** : Variables explicites, commentaires √©tapes

## üß™ **Tests et validation**

### **Tests fonctionnels :**

1. **Chargement des donn√©es**
   ```python
   print(f"PIB dataset: {gdp_dataset.shape}")
   print(f"Esp√©rance dataset: {life_dataset.shape}")
   print(f"Donn√©es fusionn√©es: {len(merged_data)}")
   ```

2. **Qualit√© des donn√©es 1900**
   ```python
   print(f"PIB 1900 - min: {gdp_values.min():.0f}, max: {gdp_values.max():.0f}")
   print(f"Esp√©rance 1900 - min: {life_values.min():.1f}, max: {life_values.max():.1f}")
   ```

3. **V√©rification de la corr√©lation**
   ```python
   correlation = gdp_values.corr(life_values)
   print(f"Coefficient de corr√©lation: {correlation:.3f}")
   ```

### **Tests d'erreur :**
1. **Fichier manquant** : Renommer un des CSV
2. **Ann√©e inexistante** : Changer '1900' en '1850'
3. **Donn√©es corrompues** : Modifier quelques valeurs dans les CSV

### **Validation visuelle :**
- **√âchelle log** : V√©rifier que l'axe X est bien logarithmique
- **Corr√©lation** : Tendance croissante visible
- **Axes** : Marques √† 300, 1k, 10k (X) et 20, 25, 30... (Y)

## üé® **Personnalisations possibles**

### **Changement d'ann√©e :**
```python
# Pour analyser 1950 au lieu de 1900
gdp_1950 = gdp_dataset[['country', '1950']].copy()
life_1950 = life_dataset[['country', '1950']].copy()
plt.title("1950")
```

### **Couleurs par r√©gion :**
```python
# Ajouter une colonne r√©gion et colorer par r√©gion
colors = {'Europe': 'blue', 'Africa': 'red', 'Asia': 'green'}
plt.scatter(gdp_values, life_values, c=[colors.get(region, 'gray') for region in regions])
```

### **Taille des points par population :**
```python
# Si on a les donn√©es de population
plt.scatter(gdp_values, life_values, s=population_values/1000000)
```

### **Ligne de tendance :**
```python
# Ajouter une r√©gression lin√©aire
import numpy as np
z = np.polyfit(np.log(gdp_values), life_values, 1)
p = np.poly1d(z)
plt.plot(gdp_values, p(np.log(gdp_values)), "r--", alpha=0.8)
```

## üîç **Points d'attention pour l'√©valuation**

### **Crit√®res d'√©valuation probables :**
1. **Fonctionnalit√©** : Le scatter plot s'affiche-t-il correctement ?
2. **Fusion de donn√©es** : Les deux datasets sont-ils correctement combin√©s ?
3. **Ann√©e 1900** : Les donn√©es correspondent-elles bien √† 1900 ?
4. **√âchelle logarithmique** : L'axe X est-il en √©chelle log ?
5. **Corr√©lation visible** : La relation PIB/esp√©rance de vie est-elle claire ?
6. **Configuration des axes** : Marques et limites correctes ?
7. **Code quality** : Norme, structure, documentation

### **D√©monstration recommand√©e :**
1. **Lancer le programme** ‚Üí montrer le scatter plot
2. **Expliquer la fusion** ‚Üí deux datasets combin√©s sur 'country'
3. **Montrer l'√©chelle log** ‚Üí pourquoi n√©cessaire pour la visualisation
4. **Interpr√©ter la corr√©lation** ‚Üí relation positive PIB/esp√©rance de vie
5. **Discuter le contexte 1900** ‚Üí d√©but de l'industrialisation
6. **R√©pondre √† la question** ‚Üí "Oui, il y a une corr√©lation positive forte"

### **Question finale du sujet :**
> "Voyez-vous une corr√©lation entre l'esp√©rance de vie et le produit int√©rieur brut ?"

**R√©ponse attendue :** "Oui, il existe une corr√©lation positive forte entre le PIB par habitant et l'esp√©rance de vie en 1900. Les pays avec un PIB plus √©lev√© tendent √† avoir une esp√©rance de vie plus longue, bien qu'il y ait une certaine dispersion due √† d'autres facteurs (g√©ographie, culture, politique sanitaire)."

## üìö **Ressources et r√©f√©rences**

### **Documentation utilis√©e :**
- [Pandas merge](https://pandas.pydata.org/docs/reference/api/pandas.merge.html)
- [Matplotlib scatter](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html)
- [Matplotlib xscale](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xscale.html)
- [Pandas to_numeric](https://pandas.pydata.org/docs/reference/api/pandas.to_numeric.html)

### **Concepts cl√©s :**
- **Corr√©lation** : Mesure de la relation lin√©aire entre deux variables
- **√âchelle logarithmique** : Transformation pour visualiser des donn√©es sur plusieurs ordres de grandeur
- **Scatter plot** : Graphique optimal pour visualiser les corr√©lations
- **Data fusion** : Combinaison de datasets sur une cl√© commune
- **PIB PPP** : Produit Int√©rieur Brut ajust√© par la Parit√© de Pouvoir d'Achat

### **Contexte √©conomique :**
- **Gapminder** : Organisation su√©doise de visualisation de donn√©es mondiales
- **Hans Rosling** : Statisticien c√©l√®bre pour ses analyses PIB/sant√©
- **Transition d√©mographique** : Relation historique richesse/esp√©rance de vie

---

*Cette documentation couvre l'int√©gralit√© de l'exercice 03 et peut servir de r√©f√©rence pour la compr√©hension, l'impl√©mentation et l'√©valuation. Elle d√©montre la ma√Ætrise de la fusion de donn√©es, de la visualisation de corr√©lations et de l'analyse statistique descriptive.*